@model CategoriesIndexViewModel
@{ ViewData["Title"] = Model.PageTitle; }

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-xl">@ViewData["Title"]</h1>
        <p class="govuk-body-l">@Model.PageDescription</p>

        @if (Model.CategoryTypes.Any())
        {
            <ul class="dfe-chevron-card__list">
                @foreach (var categoryType in Model.CategoryTypes)
                {
                    <li class="dfe-chevron-card">
                        <div class="dfe-chevron-card__wrapper">
                            <h2 class="govuk-heading-s govuk-!-margin-bottom-2">
                                <a class="govuk-link govuk-link--no-visited-state category-link" 
                                   href="/categories/@categoryType.Slug"
                                   data-category-name="@categoryType.Name"
                                   data-category-slug="@categoryType.Slug"
                                   data-category-type="category_type">
                                    @categoryType.Name
                                </a>
                            </h2>
                            @if (!string.IsNullOrEmpty(categoryType.Description))
                            {
                                <p class="dfe-chevron-card__description govuk-body govuk-body-s govuk-!-margin-bottom-2">@categoryType.Description</p>
                            }
                            @if (categoryType.MultiLevel)
                            {
                                var rootCount = categoryType.Values?.Where(v => v.Parent == null).Count() ?? 0;
                                <p class="govuk-body-s govuk-!-margin-bottom-0">@rootCount main categories</p>
                            }
                            else
                            {
                                <p class="govuk-body-s govuk-!-margin-bottom-0">@(categoryType.Values?.Count ?? 0) options</p>
                            }
                            
                            <a class="dfe-chevron-card__link category-link" 
                               href="/categories/@categoryType.Slug" 
                               aria-hidden="true" 
                               tabindex="-1"
                               data-category-name="@categoryType.Name"
                               data-category-slug="@categoryType.Slug"
                               data-category-type="category_type">
                                <span class="govuk-visually-hidden">@categoryType.Name</span>
                            </a>
                        </div>
                    </li>
                }
            </ul>
        }
        else
        {
            <div class="govuk-inset-text">
                <p>No categories are currently available.</p>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        // Google Analytics Event Tracking Functions
        function trackGAEvent(eventName, parameters = {}) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, parameters);
            } else if (typeof ga !== 'undefined') {
                ga('send', 'event', parameters.category || 'User Interaction', eventName, parameters.label || '', parameters.value || 0);
            }
            console.log('GA Event:', eventName, parameters);
        }

        // Microsoft Clarity Event Tracking Functions
        function trackClarityEvent(eventName, parameters = {}) {
            if (typeof clarity !== 'undefined') {
                clarity('event', eventName);
                
                // Set custom tags for additional context
                if (parameters.category_name) {
                    clarity('set', 'category_name', parameters.category_name);
                }
                if (parameters.category_slug) {
                    clarity('set', 'category_slug', parameters.category_slug);
                }
                if (parameters.category_type) {
                    clarity('set', 'category_type', parameters.category_type);
                }
                
                console.log('Clarity Event:', eventName, parameters);
            }
        }

        // Combined tracking function
        function trackEvent(eventName, parameters = {}) {
            trackGAEvent(eventName, parameters);
            trackClarityEvent(eventName, parameters);
        }

        function trackCategoryClick(categoryName, categorySlug, categoryType, action = 'view') {
            trackEvent('category_' + action, {
                event_category: 'Category Navigation',
                category_name: categoryName,
                category_slug: categorySlug,
                category_type: categoryType,
                event_label: categoryName,
                custom_parameter_1: categorySlug,
                custom_parameter_2: categoryType
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Category link tracking
            document.querySelectorAll('.category-link').forEach(function(link) {
                link.addEventListener('click', function(e) {
                    const categoryName = this.getAttribute('data-category-name');
                    const categorySlug = this.getAttribute('data-category-slug');
                    const categoryType = this.getAttribute('data-category-type');
                    
                    trackCategoryClick(categoryName, categorySlug, categoryType, 'view');
                });
            });
        });
    </script>
}
